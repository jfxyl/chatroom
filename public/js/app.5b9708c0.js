(function(){var t={46700:function(t,e,s){var a={"./af":63906,"./af.js":63906,"./ar":40902,"./ar-dz":3853,"./ar-dz.js":3853,"./ar-kw":20299,"./ar-kw.js":20299,"./ar-ly":96825,"./ar-ly.js":96825,"./ar-ma":66379,"./ar-ma.js":66379,"./ar-sa":87700,"./ar-sa.js":87700,"./ar-tn":2059,"./ar-tn.js":2059,"./ar.js":40902,"./az":76043,"./az.js":76043,"./be":7936,"./be.js":7936,"./bg":34078,"./bg.js":34078,"./bm":14014,"./bm.js":14014,"./bn":29554,"./bn-bd":17114,"./bn-bd.js":17114,"./bn.js":29554,"./bo":6529,"./bo.js":6529,"./br":65437,"./br.js":65437,"./bs":19647,"./bs.js":19647,"./ca":59951,"./ca.js":59951,"./cs":26113,"./cs.js":26113,"./cv":37965,"./cv.js":37965,"./cy":35858,"./cy.js":35858,"./da":33515,"./da.js":33515,"./de":62831,"./de-at":6263,"./de-at.js":6263,"./de-ch":51127,"./de-ch.js":51127,"./de.js":62831,"./dv":4510,"./dv.js":4510,"./el":68616,"./el.js":68616,"./en-au":24595,"./en-au.js":24595,"./en-ca":73545,"./en-ca.js":73545,"./en-gb":79609,"./en-gb.js":79609,"./en-ie":43727,"./en-ie.js":43727,"./en-il":93302,"./en-il.js":93302,"./en-in":46305,"./en-in.js":46305,"./en-nz":39128,"./en-nz.js":39128,"./en-sg":84569,"./en-sg.js":84569,"./eo":50650,"./eo.js":50650,"./es":26358,"./es-do":64214,"./es-do.js":64214,"./es-mx":38639,"./es-mx.js":38639,"./es-us":30232,"./es-us.js":30232,"./es.js":26358,"./et":47279,"./et.js":47279,"./eu":15515,"./eu.js":15515,"./fa":27981,"./fa.js":27981,"./fi":37090,"./fi.js":37090,"./fil":79208,"./fil.js":79208,"./fo":2799,"./fo.js":2799,"./fr":23463,"./fr-ca":2213,"./fr-ca.js":2213,"./fr-ch":52848,"./fr-ch.js":52848,"./fr.js":23463,"./fy":41468,"./fy.js":41468,"./ga":88163,"./ga.js":88163,"./gd":2898,"./gd.js":2898,"./gl":76312,"./gl.js":76312,"./gom-deva":20682,"./gom-deva.js":20682,"./gom-latn":49178,"./gom-latn.js":49178,"./gu":31400,"./gu.js":31400,"./he":52795,"./he.js":52795,"./hi":17009,"./hi.js":17009,"./hr":46506,"./hr.js":46506,"./hu":69565,"./hu.js":69565,"./hy-am":93864,"./hy-am.js":93864,"./id":5626,"./id.js":5626,"./is":36649,"./is.js":36649,"./it":90151,"./it-ch":95348,"./it-ch.js":95348,"./it.js":90151,"./ja":79830,"./ja.js":79830,"./jv":33751,"./jv.js":33751,"./ka":63365,"./ka.js":63365,"./kk":85980,"./kk.js":85980,"./km":99571,"./km.js":99571,"./kn":25880,"./kn.js":25880,"./ko":16809,"./ko.js":16809,"./ku":96773,"./ku.js":96773,"./ky":65505,"./ky.js":65505,"./lb":50553,"./lb.js":50553,"./lo":51237,"./lo.js":51237,"./lt":91563,"./lt.js":91563,"./lv":61057,"./lv.js":61057,"./me":96495,"./me.js":96495,"./mi":83096,"./mi.js":83096,"./mk":43874,"./mk.js":43874,"./ml":46055,"./ml.js":46055,"./mn":87747,"./mn.js":87747,"./mr":17113,"./mr.js":17113,"./ms":8687,"./ms-my":7948,"./ms-my.js":7948,"./ms.js":8687,"./mt":14532,"./mt.js":14532,"./my":4655,"./my.js":4655,"./nb":56961,"./nb.js":56961,"./ne":2512,"./ne.js":2512,"./nl":48448,"./nl-be":72936,"./nl-be.js":72936,"./nl.js":48448,"./nn":49031,"./nn.js":49031,"./oc-lnc":5174,"./oc-lnc.js":5174,"./pa-in":30118,"./pa-in.js":30118,"./pl":93448,"./pl.js":93448,"./pt":33518,"./pt-br":62447,"./pt-br.js":62447,"./pt.js":33518,"./ro":70817,"./ro.js":70817,"./ru":10262,"./ru.js":10262,"./sd":58990,"./sd.js":58990,"./se":43842,"./se.js":43842,"./si":37711,"./si.js":37711,"./sk":80756,"./sk.js":80756,"./sl":3772,"./sl.js":3772,"./sq":6187,"./sq.js":6187,"./sr":40732,"./sr-cyrl":75713,"./sr-cyrl.js":75713,"./sr.js":40732,"./ss":99455,"./ss.js":99455,"./sv":69770,"./sv.js":69770,"./sw":80959,"./sw.js":80959,"./ta":36459,"./ta.js":36459,"./te":25302,"./te.js":25302,"./tet":67975,"./tet.js":67975,"./tg":71294,"./tg.js":71294,"./th":2385,"./th.js":2385,"./tk":24613,"./tk.js":24613,"./tl-ph":58668,"./tl-ph.js":58668,"./tlh":58190,"./tlh.js":58190,"./tr":74506,"./tr.js":74506,"./tzl":63440,"./tzl.js":63440,"./tzm":69852,"./tzm-latn":42350,"./tzm-latn.js":42350,"./tzm.js":69852,"./ug-cn":70730,"./ug-cn.js":70730,"./uk":40099,"./uk.js":40099,"./ur":72100,"./ur.js":72100,"./uz":96002,"./uz-latn":26322,"./uz-latn.js":26322,"./uz.js":96002,"./vi":14207,"./vi.js":14207,"./x-pseudo":24674,"./x-pseudo.js":24674,"./yo":10570,"./yo.js":10570,"./zh-cn":73644,"./zh-cn.js":73644,"./zh-hk":22591,"./zh-hk.js":22591,"./zh-mo":89503,"./zh-mo.js":89503,"./zh-tw":88080,"./zh-tw.js":88080};function o(t){var e=r(t);return s(e)}function r(t){if(!s.o(a,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return a[t]}o.keys=function(){return Object.keys(a)},o.resolve=r,t.exports=o,o.id=46700},68187:function(t,e,s){"use strict";var a={};s.r(a),s.d(a,{Mi:function(){return M},JG:function(){return $},tt:function(){return E},zR:function(){return I},bG:function(){return S}});s(57658);var o=s(36369),r=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},i=[],n=s(10252),c={data(){return{}},created(){var t=this;t.$http.get("/v1/users").then((function(e){0!==e.data.errcode?(n.Z.error(e.data.msg),"/login"!==t.$route.path&&"/Login"!==t.$route.path&&t.$router.push("/login")):(t.$store.dispatch("LOGIN",e.data.data),t.$store.dispatch("GET_CHATS"),t.$store.dispatch("GET_ROOMS"),"/login"!==t.$route.path&&"/Login"!==t.$route.path||t.$router.push("/"))})).catch((function(t){console.log(t)}))},methods:{},computed:{isLogin(){return this.$store.state.user.auth}},watch:{isLogin(){console.log(this.isLogin),this.isLogin?this.$store.dispatch("CONN_SOCKET"):this.$store.dispatch("CLOSE_SOCKET")}}},l=c,d=s(70713),u=(0,d.Z)(l,r,i,!1,null,null,null),m=u.exports,h=s(72631),p=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"top"},[e("div",{staticClass:"toolbar"},[e("div",{staticClass:"search"},[t._v("疾风夕颜")]),e("a-dropdown",{attrs:{placement:"bottomCenter"}},[e("a-icon",{staticClass:"add",attrs:{type:"plus"}}),e("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[e("a-menu-item",{on:{click:t.createRoomModalShow}},[t._v(" 创建聊天室 ")]),e("a-menu-item",{on:{click:t.joinRoomModalShow}},[t._v(" 加入聊天室 ")])],1)],1)],1)]),e("div",{staticClass:"center"},[e("div",{staticClass:"menu"},[e("a-popover",{attrs:{trigger:"click",placement:"rightTop"},model:{value:t.userSettingVisible,callback:function(e){t.userSettingVisible=e},expression:"userSettingVisible"}},[e("template",{slot:"content"},[e("div",{staticClass:"tools"},[e("div",{staticClass:"item",on:{click:t.userInfoModalShow}},[e("span",[t._v("我的信息")]),e("a-icon",{attrs:{type:"right"}})],1),e("div",{staticClass:"item",on:{click:t.updatePasswordModalShow}},[e("span",[t._v("修改密码")]),e("a-icon",{attrs:{type:"right"}})],1),e("div",{staticClass:"item",on:{click:t.logout}},[e("span",[t._v("退出登录")]),e("a-icon",{attrs:{type:"right"}})],1)])]),e("template",{slot:"title"},[e("div",{staticClass:"userinfo"},[e("div",{staticClass:"avatar"},[e("img",{attrs:{src:t.userInfo.avatar,alt:""}})]),e("div",[t._v(" "+t._s(t.userInfo.name)+" ")])])]),e("div",{staticClass:"menu-item avatar-item"},[e("img",{attrs:{src:t.userInfo.avatar,alt:""}})])],2),e("div",{staticClass:"menu-item",on:{click:function(e){return t.setMenu("chat")}}},[e("router-link",{attrs:{to:"/chat"}},[e("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[e("use",{attrs:{"xlink:href":"chat"==t.currentMenu?"#icon-chat-active":"#icon-chat"}})])])],1),e("div",{staticClass:"menu-item",on:{click:function(e){return t.setMenu("room")}}},[e("router-link",{attrs:{to:"/room"}},[e("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[e("use",{attrs:{"xlink:href":"room"==t.currentMenu?"#icon-friends_active":"#icon-friends"}})])])],1)],1),e("div",{staticClass:"right-container"},[e("router-view")],1)]),e("a-modal",{attrs:{title:"创建聊天室",centered:"",afterClose:t.createRoomAfterCloseHandle},on:{ok:t.createRoom},model:{value:t.createRoomModaVisible,callback:function(e){t.createRoomModaVisible=e},expression:"createRoomModaVisible"}},[e("a-form",{attrs:{layout:"horizontal",form:t.createRoomForm}},[e("a-form-item",{attrs:{label:"房间名","label-col":{span:4},"wrapper-col":{span:14}}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入房间名"}]}],expression:"[\n              'name',\n              { rules: [{ required: true, message: '请输入房间名' }] },\n            ]"}],attrs:{placeholder:"请输入房间名","allow-clear":""}})],1),e("a-form-item",{attrs:{label:"头像",hidden:""}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["avatar"],expression:"[\n              'avatar',\n            ]"}]})],1),e("a-form-item",{attrs:{label:"头像","label-col":{span:4},"wrapper-col":{span:14}}},[e("a-upload",{staticClass:"avatar-uploader",attrs:{name:"avatar","list-type":"picture-card","show-upload-list":!1,"before-upload":t.beforeUpload}},[t.previewData?e("img",{attrs:{src:t.previewData,alt:"avatar"}}):e("div",[e("a-icon",{attrs:{type:t.loading?"loading":"plus"}}),e("div",{staticClass:"ant-upload-text"},[t._v(" Upload ")])],1)])],1)],1)],1),e("a-modal",{attrs:{title:"加入聊天室",centered:"",width:"400",afterClose:t.joinRoomAfterCloseHandle,footer:null},on:{ok:t.joinRoom},model:{value:t.joinRoomModalVisible,callback:function(e){t.joinRoomModalVisible=e},expression:"joinRoomModalVisible"}},[e("a-form",{attrs:{layout:"inline",form:t.searchRoomForm},on:{submit:t.searchRoom}},[e("a-form-item",[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["content",{rules:[{required:!0,message:"请输入聊天室信息！"}]}],expression:"[\n                'content',\n                {\n                  rules: [{ required: true, message: '请输入聊天室信息！' }],\n                },\n              ]"}],staticStyle:{width:"100%"},attrs:{placeholder:"聊天室信息"}},[e("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["field",{initialValue:"id"}],expression:"['field', { initialValue: 'id' }]"}],staticStyle:{width:"120px"},attrs:{slot:"addonBefore"},slot:"addonBefore"},[e("a-select-option",{attrs:{value:"id"}},[t._v(" 聊天室ID ")]),e("a-select-option",{attrs:{value:"name"}},[t._v(" 聊天室名称 ")])],1)],1)],1),e("a-form-item",[e("a-button",{attrs:{type:"primary","html-type":"submit"}},[t._v(" 查找 ")])],1)],1),t.searchRoomInfo?e("div",[e("div",{staticClass:"roominfo"},[e("div",{staticClass:"left"},[e("div",{staticClass:"row roomname"},[t._v(" "+t._s(t.searchRoomInfo.name)+" ")]),e("div",{staticClass:"row roomtime"},[t._v(" "+t._s(this.$moment(t.searchRoomInfo.created_at).format("YYYY-MM-DD"))+" ")])]),e("div",{staticClass:"right"},[e("img",{staticClass:"avatar",attrs:{src:t.searchRoomInfo.avatar,alt:""}})])]),e("a-button",{attrs:{type:"primary",block:""},on:{click:t.joinRoom}},[t._v("加入聊天室")])],1):t._e()],1),e("a-modal",{attrs:{title:"",centered:"",width:"400",footer:null,mask:!1,closable:!1,"body-style":{padding:0}},model:{value:t.userInfoVisible,callback:function(e){t.userInfoVisible=e},expression:"userInfoVisible"}},[e("div",{staticClass:"card-content"},[e("div",{staticClass:"card-title"},[e("div",{staticClass:"avatar"},[e("img",{attrs:{src:t.userInfo.avatar,alt:""}})]),e("div",{staticClass:"info"},[e("div",{staticClass:"nickname"},[t._v(t._s(t.userInfo.nickname))]),e("div",{staticClass:"id"},[t._v(t._s(t.userInfo.id))])])]),e("div",{staticClass:"card-col"},[e("div",{staticClass:"col-title"},[t._v("个人信息")]),e("div",{staticClass:"card-row"},[e("span",{staticClass:"label"},[t._v("用户名")]),e("span",{staticClass:"content"},[t._v(t._s(t.userInfo.name))])]),e("div",{staticClass:"card-row"},[e("span",{staticClass:"label"},[t._v("昵称")]),e("span",{staticClass:"content"},[t._v(t._s(t.userInfo.nickname))])]),e("div",{staticClass:"card-row"},[e("span",{staticClass:"label"},[t._v("性别")]),e("span",{staticClass:"content"},[t._v(t._s(t._genderMap[t.userInfo.gender]))])]),e("div",{staticClass:"card-row"},[e("span",{staticClass:"label"},[t._v("生日")]),e("span",{staticClass:"content"},[t._v(t._s(t.userInfo.birthday))])]),e("div",{staticClass:"card-row"},[e("span",{staticClass:"label"},[t._v("注册时间")]),e("span",{staticClass:"content"},[t._v(t._s(t.userInfo.created_at))])])]),e("div",{staticClass:"footer"},[e("a-button",{attrs:{type:"primary",block:""},on:{click:function(e){return t.updateUserInfoModalShow()}}},[t._v(" 编辑资料 ")])],1)])]),e("a-modal",{attrs:{title:"编辑资料",centered:"",afterClose:t.updateUserInfoAfterCloseHandle},on:{ok:t.updateUserInfo},model:{value:t.updateUserInfoVisible,callback:function(e){t.updateUserInfoVisible=e},expression:"updateUserInfoVisible"}},[e("a-form",{attrs:{layout:"horizontal",form:t.updateUserInfoForm},on:{submit:t.updateUserInfo}},[e("a-form-item",{attrs:{label:"用户名","label-col":{span:4},"wrapper-col":{span:14}}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入用户名"}]}],expression:"[\n              'name',\n              { rules: [{ required: true, message: '请输入用户名' }] },\n            ]"}],attrs:{placeholder:"请输入用户名","allow-clear":""}})],1),e("a-form-item",{attrs:{label:"昵称","label-col":{span:4},"wrapper-col":{span:14}}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["nickname",{rules:[{required:!0,message:"请输入昵称"}]}],expression:"[\n              'nickname',\n              { rules: [{ required: true, message: '请输入昵称' }] },\n            ]"}],attrs:{placeholder:"请输入昵称","allow-clear":""}})],1),e("a-form-item",{attrs:{label:"头像",hidden:"","label-col":{span:4},"wrapper-col":{span:14}}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["avatar"],expression:"[\n              'avatar',\n            ]"}]})],1),e("a-form-item",{attrs:{label:"头像","label-col":{span:4},"wrapper-col":{span:14}}},[e("a-upload",{staticClass:"avatar-uploader",attrs:{name:"avatar","list-type":"picture-card","show-upload-list":!1,"before-upload":t.beforeUpload}},[t.previewData||t.updateUserInfoForm.getFieldValue("avatar")?e("img",{attrs:{src:t.previewData||t.updateUserInfoForm.getFieldValue("avatar"),alt:"avatar"}}):e("div",[e("a-icon",{attrs:{type:t.loading?"loading":"plus"}}),e("div",{staticClass:"ant-upload-text"},[t._v(" Upload ")])],1)])],1),e("a-form-item",{attrs:{label:"性别","label-col":{span:4},"wrapper-col":{span:14}}},[e("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["gender",{rules:[{required:!0,message:"请选择性别"}]}],expression:"[\n                'gender',\n                { rules: [{ required: true, message: '请选择性别' }] },\n              ]"}],attrs:{placeholder:"性别"}},[e("a-select-option",{attrs:{value:1}},[t._v(" 男 ")]),e("a-select-option",{attrs:{value:2}},[t._v(" 女 ")]),e("a-select-option",{attrs:{value:0}},[t._v(" - ")])],1)],1),e("a-form-item",{attrs:{label:"生日","label-col":{span:4},"wrapper-col":{span:14}}},[e("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["birthday",{rules:[{required:!0,message:"请选择生日"}]}],expression:"[\n                'birthday',\n                { rules: [{ required: true, message: '请选择生日' }] },\n              ]"}],staticStyle:{width:"100%"},attrs:{valueFormat:"YYYY-MM-DD",placeholder:"生日"}})],1)],1)],1),e("a-modal",{attrs:{title:"修改密码",centered:"",afterClose:t.updatePasswordAfterCloseHandle},on:{ok:t.updatePassword},model:{value:t.updatePasswordVisible,callback:function(e){t.updatePasswordVisible=e},expression:"updatePasswordVisible"}},[e("a-form",{attrs:{form:t.updatePasswordForm,layout:"horizontal"}},[e("a-form-item",{attrs:{label:"密码","label-col":{span:4},"wrapper-col":{span:14}}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,message:"请输入密码"}]}],expression:"[\n              'password',\n              { rules: [{ required: true, message: '请输入密码' }] },\n            ]"}],staticClass:"ant-input-sm",attrs:{placeholder:"请输入密码",type:"password","allow-clear":""}})],1),e("a-form-item",{attrs:{label:"确认密码","label-col":{span:4},"wrapper-col":{span:14}}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["confirm_password",{rules:[{required:!0,message:"请输入确认密码"},{validator:t.compareToFirstPassword1}]}],expression:"[\n              'confirm_password',\n              { rules: [\n                  { required: true, message: '请输入确认密码' },\n                  {validator: compareToFirstPassword1,},\n              ] },\n            ]"}],staticClass:"ant-input-sm",attrs:{placeholder:"请输入密码",type:"password","allow-clear":""}})],1)],1)],1)],1)},v=[],f=s(21153),g=s(88178),_=s(66326),C=s(2195),b=s(89206),y=s(88238),w=s(84557),T=s(74399),j=s(73329),R=s(25431),k=s(77486);s(82801),s(23767),s(8585),s(68696);function E(t,e,s){if("string"===typeof s)n.Z.error(s);else{var a={};for(var o in s)a[o]={value:e[o],errors:[new Error(s[o])]};t.setFields(a)}}async function S(t){try{const e=await t._vm.$http.get("/v1/users");0!==e.data.errcode?n.Z.error(e.data.msg):(console.log("_this",t),t.dispatch("LOGIN",e.data.data)),console.log(e.data)}catch(e){console.error(e)}}function I(t){const e=/^data:([A-Za-z-+/]+);base64,/,s=t.match(e);return s&&s.length>1?s[1]:null}function M(t,e="",s=512){t=t.split(",").pop();const a=atob(t),o=[];for(let i=0;i<a.length;i+=s){const t=a.slice(i,i+s),e=new Array(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s);const r=new Uint8Array(e);o.push(r)}const r=new Blob(o,{type:e});return r}function $(t){let e=t,s=document.createElement("input");s.value=e,document.body.appendChild(s),s.select(),document.execCommand("Copy"),s.remove(),n.Z.success("复制成功")}o.ZP.use(f.Z);var O={name:"HomeView",components:{"a-menu":g.ZP,"a-menu-item":g.ZP.Item,"a-dropdown":_.ZP,"a-icon":C.Z,"a-form":b.ZP,"a-form-item":b.ZP.Item,"a-input":y.Z,"a-upload":w.ZP,"a-button":T.Z,"a-select":j.ZP,"a-select-option":j.ZP.Option,"a-popover":R.Z,"a-date-picker":k.Z},computed:{currentMenu(){return this.$store.state.menu.currentMenu},userInfo(){return this.$store.state.user.info}},methods:{setMenu(t){this.$store.dispatch("SET_CURRENT_MENU",t)},createRoomModalShow(){this.createRoomModaVisible=!0},joinRoomModalShow(){this.joinRoomModalVisible=!0},beforeUpload(t){const e=["image/jpeg","image/png","image/gif","image/webp","image/bmp"],s=e.includes(t.type);if(!s)return n.Z.error("不支持的图片格式!"),!1;const a=t.size/1024/1024<2;if(!a)return n.Z.error("图片大小不能超过2MB!"),!1;const o=new FileReader;return o.onload=t=>{const e=t.target.result;this.showPreview(e)},o.readAsDataURL(t),!1},showPreview(t){this.previewData=t},async uploadAvatar(t,e){let s=t.dirtype,a=this;if(""!==a.previewData){const t=I(a.previewData);if(t){const r=await a.$http.get(`/v1/oss/signature?dirtype=${s}&content-type=${t}`);if(0!==r.data.errcode)n.Z.error(r.data.msg);else{const s=r.data.data.uploadUrl;var o={method:"put",url:s,headers:{"Content-Type":t},data:M(a.previewData)};await a.$http.request(o).then(e(r)).catch((function(t){console.log(t)}))}}}},createRoom(t){t.preventDefault(),this.createRoomForm.validateFields((async t=>{if(!t){let t=this;await t.uploadAvatar({dirtype:"room_avatar"},(function(e){t.createRoomForm.setFieldsValue({avatar:e.data.data.url})})),t.createRoomForm.validateFields((async(e,s)=>{e||t.$http.post("/v1/rooms",s).then((function(e){0!==e.data.errcode?E(t.createRoomForm,s,e.data.msg):(t.$store.dispatch("GET_ROOMS"),t.$store.dispatch("GET_CHATS"),n.Z.success("创建成功"),t.createRoomModaVisible=!1)})).catch((function(t){console.log(t)}))}))}}))},joinRoom(){let t=this;t.$http.post(`/v1/rooms/${t.searchRoomInfo.id}/join`).then((function(e){0!==e.data.errcode?n.Z.error(e.data.msg):(t.$store.dispatch("GET_ROOMS"),t.$store.dispatch("GET_CHATS"),n.Z.success("操作成功"),t.joinRoomModalVisible=!1)})).catch((function(t){console.log(t)}))},searchRoom(t){t.preventDefault(),this.searchRoomForm.validateFields(((t,e)=>{if(!t){let t=this;t.$http.get(`/v1/rooms/find?field=${e.field}&content=${e.content}`).then((function(s){0!==s.data.errcode?(E(t.searchRoomForm,e,s.data.msg),t.searchRoomInfo=null):t.searchRoomInfo=s.data.data})).catch((function(t){console.log(t)}))}}))},createRoomAfterCloseHandle(){this.createRoomForm.resetFields(["name","avatar"]),this.previewData=""},joinRoomAfterCloseHandle(){this.searchRoomForm.resetFields(["field","content"]),this.searchRoomInfo=null},updateUserInfoAfterCloseHandle(){this.updateUserInfoForm.resetFields(["name","nickname","avatar","gender","birthday"]),this.previewData=""},updatePasswordAfterCloseHandle(){this.updatePasswordForm.resetFields(["password","confirm_password"])},userInfoModalShow(){this.getUserInfo(),this.userSettingVisible=!1},getUserInfo:function(){let t=this;t.$http.get(`/v1/users/${this.userInfo.id}`).then((function(e){0!==e.data.errcode?n.Z.error(e.data.msg):(t.$store.dispatch("SET_USER_INFO",e.data.data),t.userInfoVisible=!0)}))},updateUserInfoModalShow(){this.getUserInfo(),this.updateUserInfoVisible=!0,this.Data=this.userInfo.avatar,this.$nextTick((()=>{this.updateUserInfoForm.setFieldsValue({name:this.userInfo.name,nickname:this.userInfo.nickname,avatar:this.userInfo.avatar,gender:this.userInfo.gender,birthday:this.userInfo.birthday})}))},updateUserInfo(t){t.preventDefault(),this.updateUserInfoForm.validateFields((async t=>{if(console.log("updateUserInfo"),!t){let t=this;await t.uploadAvatar({dirtype:"user_avatar"},(function(e){t.updateUserInfoForm.setFieldsValue({avatar:e.data.data.url})})),t.updateUserInfoForm.validateFields((async(e,s)=>{e||t.$http.put("/v1/users",s).then((function(e){0!==e.data.errcode?E(t.updateUserInfoForm,s,e.data.msg):(t.$store.dispatch("GET_USER"),n.Z.success("修改成功"),t.updateUserInfoVisible=!1)})).catch((function(t){console.log(t)}))}))}}))},updatePassword(t){t.preventDefault(),this.updatePasswordForm.validateFields((async(t,e)=>{if(!t){let t=this;t.$http.put("/v1/users/password",e).then((function(s){0!==s.data.errcode?E(t.updatePasswordForm,e,s.data.msg):(n.Z.success("修改成功"),t.updatePasswordVisible=!1)})).catch((function(t){console.log(t)}))}}))},updatePasswordModalShow(){this.updatePasswordVisible=!0},compareToFirstPassword1(t,e,s){const a=this.updatePasswordForm;e&&e!==a.getFieldValue("password")?s("两次密码输入不一致!"):s()},logout(){this.$store.dispatch("LOGOUT"),this.$router.push("/login")}},data(){return{createRoomModaVisible:!1,joinRoomModalVisible:!1,userInfoVisible:!1,userSettingVisible:!1,updateUserInfoVisible:!1,updatePasswordVisible:!1,createRoomForm:this.$form.createForm(this,{name:"coordinated"}),searchRoomForm:this.$form.createForm(this,{name:"coordinated"}),updateUserInfoForm:this.$form.createForm(this,{name:"coordinated"}),updatePasswordForm:this.$form.createForm(this,{name:"coordinated"}),searchRoomInfo:null,loading:!1,previewData:""}}},x=O,P=(0,d.Z)(x,p,v,!1,null,"57b5246c",null),Z=P.exports,U=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("ChatsPanel"),e("ChatPanel")],1)},N=[],F=function(){var t=this,e=t._self._c;return e("div",{staticClass:"chats"},t._l(t.chats,(function(s,a,o){return e("a-dropdown",{key:o,staticClass:"chat",attrs:{trigger:["contextmenu"]}},[e("div",{class:{active:t.currentChat.id===s.id},on:{click:function(e){return t.current(s)}}},[e("a-badge",{attrs:{dot:s.unread_count>0}},[e("div",{staticClass:"avatar"},[e("img",{staticClass:"img",attrs:{src:s.avatar,alt:""}})])]),e("div",{staticClass:"info"},[e("div",{staticClass:"top"},[t._v(t._s(s.name))])])],1),e("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[e("a-menu-item",{key:"1",on:{click:function(e){return t.toggleTop(s)}}},[t._v("置顶")]),e("a-menu-item",{key:"2",on:{click:function(e){return t.toggleDisturb(s)}}},[t._v("消息免打扰")]),e("a-menu-divider")],1)],1)})),1)},V=[],A=s(68056),H={name:"ChatsPanel",components:{"a-menu":g.ZP,"a-menu-item":g.ZP.Item,"a-menu-divider":g.ZP.Divider,"a-dropdown":_.ZP,"a-badge":A.Z},data(){return{count:6}},computed:{chats(){return this.$store.state.chat.chats},currentChat(){return this.$store.state.chat.currentChat}},methods:{current(t){this.$store.dispatch("SET_CURRENT_CHAT",t)},toggleTop(t){console.log(t)},toggleDisturb(t){console.log(t)}}},G=H,q=(0,d.Z)(G,F,V,!1,null,"05acb3a9",null),z=q.exports,D=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.currentChat.id,expression:"currentChat.id"}],attrs:{id:"chat-content"}},[e("div",{staticClass:"header"},[e("div",{staticClass:"left"},[e("div",{staticClass:"avatar"},[e("img",{attrs:{src:t.currentChat.avatar,alt:""}})]),e("div",{staticClass:"info"},[e("div",{staticClass:"name"},[t._v(t._s(t.currentChat.name))]),e("div",{staticClass:"count"},[e("img",{attrs:{src:"https://jfxy.oss-cn-nanjing.aliyuncs.com/chatroom/static/users.png",alt:""}}),e("span",[t._v(t._s(t.currentChat.users?t.currentChat.users.length:0))])])])]),e("div",{staticClass:"right"},[e("div",{staticClass:"item",on:{click:t.setting}},[e("a-icon",{attrs:{type:"setting"}})],1)])]),e("div",{ref:"chatmsgs",staticClass:"content",attrs:{id:"chat-box"},on:{scroll:t.handleChatBoxScroll}},[e("ul",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}]},t._l(t.currentMsgs,(function(s,a){return e("li",{key:a,ref:"msg",refInFor:!0,attrs:{id:"message-"+s.id}},[s.msg_type===t._const.TypeNotice?e("div",{staticClass:"notice"},[t._v(t._s(s.content))]):e("div",{class:[s.sender_id!=t.userInfo.id?"other":"self","body"]},[e("div",{staticClass:"avatar",on:{click:function(e){return t.getUserInfo(s.sender)}}},[e("img",{attrs:{src:s.sender.avatar,alt:""}})]),e("div",{staticClass:"msg"},[e("div",{staticClass:"msg-header"},[e("div",{staticClass:"sender"},[t._v(t._s(s.sender.nickname))]),e("div",{staticClass:"sendtime"},[t._v(t._s(t.formatDate(s.created_at)))])]),e("div",{staticClass:"msg-body"},[e("div",{staticClass:"msg-content"},[s.msg_type===t._const.TypeText?e("div",{staticClass:"text"},[e("span",[e("pre",[t._v(t._s(s.content))])]),e("div",{staticClass:"arrow"})]):s.msg_type===t._const.TypeImg?e("div",{staticClass:"img"},[e("img",{attrs:{src:s.content,alt:""}})]):s.msg_type===t._const.TypeFile?e("div",{staticClass:"file"},[e("div",{staticClass:"file-type"},[t._v(" file ")]),e("div",{staticClass:"file-status"},[e("div",{staticClass:"file-name"},[t._v(t._s(s.content))]),e("div",{staticClass:"file-size"},[t._v("250kb")])])]):t._e()])]),e("a-popover",{attrs:{title:"消息接收人列表",trigger:"click",placement:"topRight"},scopedSlots:t._u([{key:"content",fn:function(){return[e("div",{staticClass:"readinfo"},[e("div",{staticClass:"list readers"},[e("p",{staticClass:"notice"},[e("span",{staticClass:"blue"},[t._v(t._s(t.readInfo.readers.length))]),t._v(" 人已读")]),e("ul",t._l(t.readInfo.readers,(function(s,a){return e("li",{key:a},[e("div",{staticClass:"avatar"},[e("img",{attrs:{src:s.avatar,alt:""}})]),e("div",{staticClass:"name"},[t._v(t._s(s.nickname))])])})),0)]),e("div",{staticClass:"list unreaders"},[e("p",{staticClass:"notice"},[e("span",{staticClass:"blue"},[t._v(t._s(t.readInfo.unreaders.length))]),t._v(" 人未读")]),e("ul",t._l(t.readInfo.unreaders,(function(s,a){return e("li",{key:a},[e("div",{staticClass:"avatar"},[e("img",{attrs:{src:s.avatar,alt:""}})]),e("div",{staticClass:"name"},[t._v(t._s(s.nickname))])])})),0)])])]},proxy:!0}],null,!0)},[s.sender_id==t.userInfo.id?e("div",{staticClass:"msg-footer",on:{click:function(e){return t.getReadInfo(s)}}},[s.unreaders.length>0?e("div",{staticClass:"unread"},[t._v(" "+t._s(s.unreaders.length)+"人未读 ")]):e("div",{staticClass:"allread"},[t._v(" 全部已读 ")])]):t._e()])],1)])])})),0)]),e("div",{staticClass:"input"},[e("div",{staticClass:"tools"},[e("ul",{staticClass:"toolsul"},[e("li",{staticClass:"toolsli",on:{click:function(e){e.stopPropagation(),t.emojiVisible=!t.emojiVisible}}},[e("svg",{staticClass:"toolssvg emoji",attrs:{"aria-hidden":"true"}},[e("use",{attrs:{"xlink:href":"#icon-emoji"}})])]),e("li",{staticClass:"toolsli",on:{click:t.chooseFile}},[e("svg",{staticClass:"toolssvg emoji",attrs:{"aria-hidden":"true"}},[e("use",{attrs:{"xlink:href":"#icon-file"}})])])]),t.emojiVisible?e("EmojiPanel",{staticClass:"emojis",on:{chooseEmoji:t.chooseEmoji}}):t._e()],1),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.msg,expression:"msg"}],ref:"textarea",staticClass:"textarea",attrs:{name:"",id:"",cols:"30",rows:"10"},domProps:{value:t.msg},on:{keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),e.ctrlKey||e.shiftKey||e.altKey||e.metaKey?null:t.sendMsg.apply(null,arguments))},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.shiftKey?t.addLine.apply(null,arguments):null}],input:function(e){e.target.composing||(t.msg=e.target.value)}}})])]),e("div",{directives:[{name:"show",rawName:"v-show",value:0==Object.keys(t.currentChat).length,expression:"Object.keys(currentChat).length == 0"}]}),e("a-drawer",{attrs:{title:"设置",placement:"right",closable:!0,visible:t.settingVisible,width:"420",maskClosable:!0,mask:!0,maskStyle:{animation:"none",opacity:0},bodyStyle:{padding:0},zIndex:1e3,wrapStyle:{marginTop:"42px"}},on:{close:t.onSettingClose}},[e("div",{staticClass:"room-drawer"},[e("div",{staticClass:"item header"},[e("div",{staticClass:"avatar"},[e("img",{attrs:{src:t.currentChat.avatar,alt:""}})]),e("div",{staticClass:"info"},[e("div",{staticClass:"name"},[t._v(t._s(t.currentChat.name)+" "),e("a-icon",{attrs:{type:"copy"},on:{click:function(e){return t.copy(t.currentChat.name)}}})],1)])]),e("div",{staticClass:"item"},[e("div",{},[t._v(" 成员 "+t._s(t.currentChat.users?t.currentChat.users.length:0)+"人 ")]),t.currentChat&&t.currentChat.users?e("div",{staticClass:"members"},t._l(t.currentChat.users.slice(0,20),(function(s,a){return e("div",{key:a,staticClass:"member",on:{click:function(e){return t.getUserInfo(s)}}},[e("div",{staticClass:"avatar"},[e("img",{attrs:{src:s.avatar,alt:""}})]),e("div",{staticClass:"nickname"},[t._v(" "+t._s(s.nickname)+" ")])])})),0):t._e(),t.currentChat&&t.currentChat.users&&t.currentChat.users.length>20?e("div",{staticClass:"more",on:{click:t.moreMembers}},[t._v("查看更多")]):t._e()]),e("div",{staticClass:"item"},[e("div",{staticClass:"item-row"},[e("span",{staticClass:"label"},[t._v("聊天室ID")]),e("span",{staticClass:"content"},[t._v(t._s(t.currentChat.id)+" "),e("a-icon",{attrs:{type:"copy"},on:{click:function(e){return t.copy(t.currentChat.id)}}})],1)])]),e("div",{staticClass:"item footer"},[e("a-button",{attrs:{type:"danger",ghost:""},on:{click:function(e){return t.quitRoom(t.currentChat)}}},[t._v(" 退出聊天室 ")])],1)])]),e("a-drawer",{attrs:{title:"成员",width:"420",closable:!0,visible:t.moreMembersVisible,maskClosable:!0,mask:!0,maskStyle:{animation:"none",opacity:0},bodyStyle:{padding:0,height:"calc(100% - 97px)",overflow:"auto"},zIndex:1001,wrapStyle:{marginTop:"42px"}},on:{close:t.onMoreMembersClose}},[e("div",{staticClass:"member-drawer"},[t.currentChat&&t.currentChat.users?e("div",{staticClass:"members"},t._l(t.currentChat.users,(function(s,a){return e("div",{key:a,staticClass:"member",on:{click:function(e){return t.getUserInfo(s)}}},[e("div",{staticClass:"avatar"},[e("img",{attrs:{src:s.avatar,alt:""}})]),e("div",{staticClass:"name"},[t._v(" "+t._s(s.nickname)+" ")])])})),0):t._e()])]),e("a-modal",{attrs:{title:"",centered:"",width:"400",footer:null,mask:!1,closable:!1,"body-style":{padding:0},zIndex:1002},model:{value:t.userInfoVisible,callback:function(e){t.userInfoVisible=e},expression:"userInfoVisible"}},[e("div",{staticClass:"card-content"},[e("div",{staticClass:"card-title"},[e("div",{staticClass:"avatar"},[e("img",{attrs:{src:t.displayUserInfo.avatar,alt:""}})]),e("div",{staticClass:"info"},[e("div",{staticClass:"nickname"},[t._v(t._s(t.displayUserInfo.nickname))]),e("div",{staticClass:"id"},[t._v(t._s(t.displayUserInfo.id))])])]),e("div",{staticClass:"card-col"},[e("div",{staticClass:"col-title"},[t._v("个人信息")]),e("div",{staticClass:"card-row"},[e("span",{staticClass:"label"},[t._v("用户名")]),e("span",{staticClass:"content"},[t._v(t._s(t.displayUserInfo.name))])]),e("div",{staticClass:"card-row"},[e("span",{staticClass:"label"},[t._v("昵称")]),e("span",{staticClass:"content"},[t._v(t._s(t.displayUserInfo.nickname))])]),e("div",{staticClass:"card-row"},[e("span",{staticClass:"label"},[t._v("性别")]),e("span",{staticClass:"content"},[t._v(t._s(t._genderMap[t.displayUserInfo.gender]))])]),e("div",{staticClass:"card-row"},[e("span",{staticClass:"label"},[t._v("生日")]),e("span",{staticClass:"content"},[t._v(t._s(t.displayUserInfo.birthday))])]),e("div",{staticClass:"card-row"},[e("span",{staticClass:"label"},[t._v("注册时间")]),e("span",{staticClass:"content"},[t._v(t._s(t.displayUserInfo.created_at))])])])])])],1)},L=[],K=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"emoji"},on:{click:function(t){t.stopPropagation()}}},[e("ul",{staticClass:"emojiul"},t._l(t.emojis,(function(s,a){return e("li",{key:a,staticClass:"emojili",on:{click:function(e){return e.stopPropagation(),t.chooseEmoji(s)}}},[t._v(" "+t._s(s)+" ")])})),0)])},B=[],Y={name:"EmojiPanel",data(){return{emojis:["😄","😃","😀","😊","😉","😍","😘","😚","😗","😙","😜","😝","😛","😳","😁","😔","😌","😒","😞","😣","😢","😂","😭","😪","😥","😰","😅","😓","😩","😫","😨","😱","😠","😡","😤","😖","😆","😋","😷","😎","😴","😵","😲","😟","😦","😧","👿","😮","😬","😐","😕","😯","😏","😑","👲","👳","👮","👷","💂","👶","👦","👧","👨","👩","👴","👵","👱","👼","👸","😺","😸","😻","😽","😼","🙀","😿","😹","😾","👹","👺","🙈","🙉","🙊","💀","👽","💩","🔥","✨","🌟","💫","💥","💢","💦","💧","💤","💨","👂","👀","👃","👅","👄","👍","👎","👌","👊","✊","👋","✋","👐","👆","👇","👉","👈","🙌","🙏","👏","💪","🚶","🏃","💃","👫","👪","💏","💑","👯","🙆","🙅","💁","🙋","💆","💇","💅","👰","🙎","🙍","🙇","🎩","👑","👒","👟","👞","👡","👠","👢","👕","👔","👚","👗","🎽","👖","👘","👙","💼","👜","👝","👛","👓","🎀","🌂","💄","💛","💙","💜","💚","💔","💗","💓","💕","💖","💞","💘","💌","💋","💍","💎","👤","💬","👣"]}},methods:{chooseEmoji(t){this.$emit("chooseEmoji",t)}}},J=Y,W=(0,d.Z)(J,K,B,!1,null,"755db8f6",null),Q=W.exports,X=s(52927),tt=s(77250),et=s(36797),st=s.n(et),at={name:"ChatPanel",directives:{infiniteScroll:X.infiniteScroll},components:{EmojiPanel:Q,"a-modal":f.Z,"a-popover":R.Z,"a-icon":C.Z,"a-drawer":tt.Z,"a-button":T.Z},data(){return{msg:"",emojiVisible:!1,readInfoVisible:!1,userInfoVisible:!1,settingVisible:!1,moreMembersVisible:!1,readInfo:{readers:[],unreaders:[]},readInfoStyle:{position:"absolute",top:"0px",right:"0px"},displayUserInfo:{}}},props:["chat"],created(){console.log("created")},mounted:function(){console.log("mounted"),this.globalClick(this.handleClickOut),this.$refs.chatmsgs.addEventListener("scroll",(()=>{console.log("this.$refs.chatmsgs.scrollTop",this.$refs.chatmsgs.scrollTop),0===this.$refs.chatmsgs.scrollTop&&this.loadMore()}))},computed:{currentChat(){return this.$store.state.chat.currentChat},currentMsgs(){return this.$store.state.chat.currentMsgs},userInfo(){return this.$store.state.user.info}},methods:{async loadMore(){var t,e;Array.isArray(this.$refs.msg)?this.$refs.msg.length>0&&(t=this.$refs.msg[0],e=t.id):(t=this.$refs.msg,e=t.id);var s=this;await this.$store.dispatch("GET_MORE_MESSAGE").then((()=>{e&&s.$refs.msg&&this.$nextTick((()=>{t=s.$refs.msg.find((t=>t.id===e)),s.$refs.chatmsgs.scrollTop=t.offsetTop-102}))}))},copy(t){$(t)},adduser(){},setting(){this.settingVisible=!0},moreMembers(){this.moreMembersVisible=!0},onSettingClose(){this.settingVisible=!1,console.log("onSettingClose")},onMoreMembersClose(){this.moreMembersVisible=!1,console.log("onSettingClose")},quitRoom(t){let e=this;f.Z.confirm({title:"确定退出聊天室么?",okText:"确定",cancelText:"取消",onOk(){e.$http.post(`/v1/rooms/${t.id}/quit`).then((function(t){0!==t.data.errcode?n.Z.error(t.data.msg):(e.settingVisible=!1,e.$store.dispatch("SET_CURRENT_CHAT",{}),e.$store.dispatch("GET_ROOMS"),e.$store.dispatch("GET_CHATS"),n.Z.success("操作成功"))})).catch((function(t){console.log(t)}))},onCancel(){}})},formatDate(t){return st()(t).format("YYYY年M月D日 HH:mm")},handleChatBoxScroll:function(){const t=document.getElementById("chat-box"),e=this.getVisibleMessages(t);console.log("visibleMessages",e);for(const s of e)!1===s.readed&&(this.markMessageAsRead(s),s.unread=!1)},getVisibleMessages:function(t){const e=t.scrollTop+102,s=[];for(var a of this.currentMsgs){var o=document.getElementById(`message-${a.id}`);if(o){var r=o.offsetTop+o.clientHeight/2;r>=e&&r<=e+t.clientHeight&&s.push(a)}}return s},markMessageAsRead:function(t){if(t.msg_type!=this._const.TypeNotice&&!1===t.readed){var e={action:"read",body:{message_id:t.id}};this.$store.state.socket.socket.send(JSON.stringify(e)),this.currentChat.unread_count=this.currentChat.unread_count>0?this.currentChat.unread_count-1:0,t.readed=!0}},getUserInfo:function(t){let e=this;e.$http.get(`/v1/users/${t.id}`).then((function(t){0!==t.data.errcode?n.Z.error(t.data.msg):(console.log(t.data.data),e.displayUserInfo=t.data.data,e.userInfoVisible=!0)}))},getReadInfo:function(t){let e=this;e.$http.get(`/v1/messages/${t.id}/readinfo`).then((function(s){0!==s.data.errcode?t.error(s.data.msg):(console.log(s.data.data),e.readInfo=s.data.data,e.readInfoVisible=!0)}))},handleClickOut:function(){this.emojiVisible=!1,console.log(11111)},sendMsg(){this.msg.length>0&&this.requestMsg(this._const.TypeText,this.msg)},addLine(){this.insertText("\n")},chooseEmoji(t){this.insertText(t)},insertText(t){var e=this.$refs.textarea,s=e.selectionStart,a=e.selectionEnd;this.msg=this.msg.substring(0,e.selectionStart)+t+this.msg.substring(e.selectionEnd,this.msg.length),s+=t.length,a+=t.length,e.blur(),setTimeout((()=>{e.setSelectionRange(s,a),e.focus()}))},scrollToBottom(){console.log("scrollToBottom");var t=document.querySelector("#chat-box");console.log("content",t),setTimeout((()=>{console.log(t.scrollHeight,t.scrollTop),t.scrollTop=t.scrollHeight}))},chooseFile(){},requestMsg(t,e){var s={chat_type:2,receiver_id:this.currentChat.id,msg_type:t,content:e,reply_id:0};console.log(s,JSON.stringify(s));let a=this;a.$http.post("/v1/messages",s).then((function(t){0!==t.data.errcode?n.Z.error(t.data.msg):(a.currentMsgs.push(t.data.data),a.msg="",a.scrollToBottom())}))}},watch:{currentChat(){console.log("scrollToBottom"),this.scrollToBottom()},currentMsgs(t){if(0===t.length)return;const e=document.getElementById("chat-box"),s=e.scrollTop+102,a=t.length>=2?t.length-2:0,o=document.getElementById(`message-${t[a].id}`);if(o){const t=o.offsetTop+o.clientHeight/2;t>=s&&t<=s+e.clientHeight&&this.scrollToBottom()}}}},ot=at,rt=(0,d.Z)(ot,D,L,!1,null,"33310de5",null),it=rt.exports,nt={name:"ChatView",components:{ChatsPanel:z,ChatPanel:it},computed:{},mounted:function(){this.$store.dispatch("SET_CURRENT_MENU","chat")},methods:{},data(){return{}}},ct=nt,lt=(0,d.Z)(ct,U,N,!1,null,"3d59a134",null),dt=lt.exports,ut=function(){var t=this,e=t._self._c;return e("div",{staticClass:"room-container"},[e("RoomsPanel"),e("RoomPanel")],1)},mt=[],ht=function(){var t=this,e=t._self._c;return e("div",{staticClass:"rooms"},t._l(t.rooms,(function(s,a,o){return e("a-dropdown",{key:o,staticClass:"room",attrs:{trigger:["contextmenu"]}},[e("div",{class:{active:t.currentRoom.id===s.id},on:{click:function(e){return t.current(s)}}},[e("div",{staticClass:"avatar"},[e("img",{staticClass:"img",attrs:{src:s.avatar,alt:""}})]),e("div",{staticClass:"info"},[e("div",{staticClass:"top"},[t._v(t._s(s.name))])])]),e("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[e("a-menu-item",{key:"1",on:{click:function(e){return t.toChat(s)}}},[t._v("发消息")]),e("a-menu-divider"),e("a-menu-item",{key:"3",on:{click:function(e){return t.quitRoom(s)}}},[t._v("退出聊天室")])],1)],1)})),1)},pt=[],vt={name:"RoomsPanel",components:{"a-menu":g.ZP,"a-menu-item":g.ZP.Item,"a-menu-divider":g.ZP.Divider,"a-dropdown":_.ZP},data(){return{}},computed:{rooms(){return this.$store.state.room.rooms},currentRoom(){return this.$store.state.room.currentRoom},chats(){return this.$store.state.chat.chats}},methods:{current(t){this.$store.dispatch("SET_CURRENT_ROOM",t)},toChat(t){for(let e=0;e<this.chats.length;e++)if(this.chats[e].id==t.id){this.$store.dispatch("SET_CURRENT_CHAT",this.chats[e]);break}this.$router.push({path:"/chat"})},setAlias(t){console.log(t)},quitRoom(t){let e=this;f.Z.confirm({title:"确定退出聊天室么?",okText:"确定",cancelText:"取消",onOk(){e.$http.post(`/v1/rooms/${t.id}/quit`).then((function(t){0!==t.data.errcode?n.Z.error(t.data.msg):(e.settingVisible=!1,e.$store.dispatch("SET_CURRENT_CHAT",{}),e.$store.dispatch("GET_ROOMS"),e.$store.dispatch("GET_CHATS"),n.Z.success("操作成功"))})).catch((function(t){console.log(t)}))},onCancel(){}})}}},ft=vt,gt=(0,d.Z)(ft,ht,pt,!1,null,"00a30bf0",null),_t=gt.exports,Ct=function(){var t=this,e=t._self._c;return t.currentRoom.id?e("div",{staticClass:"container"},[e("div",{staticClass:"avatar"},[e("img",{staticClass:"img",attrs:{src:t.currentRoom.avatar,alt:""}})]),e("div",{staticClass:"name"},[t._v(t._s(t.currentRoom.name))]),e("button",{staticClass:"button",on:{click:t.toChat}},[t._v("进入聊天室")])]):t._e()},bt=[],yt={name:"RoomPanel",components:{},data(){return{}},computed:{currentRoom(){return this.$store.state.room.currentRoom},chats(){return this.$store.state.chat.chats}},methods:{toChat(){for(let t=0;t<this.chats.length;t++)if(this.chats[t].id==this.currentRoom.id){this.$store.dispatch("SET_CURRENT_CHAT",this.chats[t]);break}this.$router.push({path:"/chat"})}}},wt=yt,Tt=(0,d.Z)(wt,Ct,bt,!1,null,"354b5bc1",null),jt=Tt.exports,Rt={name:"RoomView",components:{RoomsPanel:_t,RoomPanel:jt},computed:{},mounted:function(){this.$store.dispatch("SET_CURRENT_MENU","room")},methods:{},data(){return{}}},kt=Rt,Et=(0,d.Z)(kt,ut,mt,!1,null,"072868e2",null),St=Et.exports,It=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"top"}),e("div",{staticClass:"center"},[e("div",{staticClass:"center-container"},[t._m(0),"login"==t.action?e("LoginPanel",{on:{jump:function(e){t.action=e}}}):"register"==t.action?e("RegisterPanel",{on:{jump:function(e){t.action=e}}}):t._e()],1)]),e("div",{staticClass:"bottom"})])},Mt=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"left-container"},[e("div",{staticClass:"title"},[t._v("来聊天吧")]),e("span",{staticClass:"sub_title"},[t._v("可爱的人儿呢")]),e("img",{staticClass:"intro-image",attrs:{src:"https://web.rentsoft.cn/static/media/login_bg.e42640a5.png"}})])}],$t=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-form"},[e("div",{staticClass:"form_title"},[t._v("ChatRoom")]),e("a-form",{attrs:{form:t.form,layout:"vertical"},on:{submit:t.handleSubmit}},[e("a-form-item",{attrs:{label:"用户名"}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入用户名"}]}],expression:"[\n            'name',\n            { rules: [{ required: true, message: '请输入用户名' }] },\n          ]"}],attrs:{placeholder:"请输入用户名","allow-clear":""}})],1),e("a-form-item",{attrs:{label:"密码"}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,message:"请输入密码"}]}],expression:"[\n            'password',\n            { rules: [{ required: true, message: '请输入密码' }] },\n          ]"}],attrs:{placeholder:"请输入密码",type:"password","allow-clear":""}})],1),e("a-form-item",[e("a-button",{attrs:{type:"primary","html-type":"submit",block:""}},[t._v("登录")])],1)],1),e("div",{staticClass:"access_bottom"},[e("a-button",{attrs:{type:"link"},on:{click:function(e){return t.$emit("jump","register")}}},[t._v(" 立即注册 ")])],1)],1)},Ot=[],xt={name:"LoginPanel",components:{"a-form":b.ZP,"a-form-item":b.ZP.Item,"a-input":y.Z,"a-button":T.Z},data(){return{form:this.$form.createForm(this,{name:"coordinated"})}},methods:{handleSubmit(t){t.preventDefault(),this.form.validateFields(((t,e)=>{if(!t){let t=this;t.$http.post("/v1/users/login",e).then((function(s){0!==s.data.errcode?E(t.form,e,s.data.msg):(t.$store.dispatch("LOGIN",s.data.data.user),t.$store.dispatch("REFRESH_TOKEN",s.data.data.jwt),n.Z.success("登录成功"),t.$router.push("/"),t.$store.dispatch("GET_USER"),t.$store.dispatch("GET_CHATS"),t.$store.dispatch("GET_ROOMS"))}))}}))}}},Pt=xt,Zt=(0,d.Z)(Pt,$t,Ot,!1,null,"6554221c",null),Ut=Zt.exports,Nt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"register-form"},[e("a-button",{staticClass:"back",attrs:{type:"link"},on:{click:function(e){return t.$emit("jump","login")}}},[t._v(" 返回 ")]),e("div",{staticClass:"form_title"},[t._v("ChatRoom")]),e("a-form",{attrs:{form:t.form,layout:"vertical"},on:{submit:t.handleSubmit}},[e("a-form-item",{attrs:{label:"用户名"}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入用户名"}]}],expression:"[\n            'name',\n            { rules: [{ required: true, message: '请输入用户名' }] },\n          ]"}],staticClass:"ant-input-sm",attrs:{placeholder:"请输入用户名","allow-clear":""}})],1),e("a-form-item",{attrs:{label:"密码"}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,message:"请输入密码"}]}],expression:"[\n            'password',\n            { rules: [{ required: true, message: '请输入密码' }] },\n          ]"}],staticClass:"ant-input-sm",attrs:{placeholder:"请输入密码",type:"password","allow-clear":""}})],1),e("a-form-item",{attrs:{label:"确认密码"}},[e("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["confirm_password",{rules:[{required:!0,message:"请输入确认密码"},{validator:t.compareToFirstPassword}]}],expression:"[\n            'confirm_password',\n            { rules: [\n                { required: true, message: '请输入确认密码' },\n                {validator: compareToFirstPassword,},\n            ] },\n          ]"}],staticClass:"ant-input-sm",attrs:{placeholder:"请输入密码",type:"password","allow-clear":""}})],1),e("a-form-item",[e("a-button",{attrs:{type:"primary","html-type":"submit",block:""}},[t._v("注册")])],1)],1)],1)},Ft=[],Vt={name:"RegisterPanel",components:{"a-form":b.ZP,"a-form-item":b.ZP.Item,"a-input":y.Z,"a-button":T.Z},data(){return{form:this.$form.createForm(this,{name:"coordinated"})}},methods:{compareToFirstPassword(t,e,s){const a=this.form;e&&e!==a.getFieldValue("password")?s("两次密码输入不一致!"):s()},handleSubmit(t){t.preventDefault(),this.form.validateFields(((t,e)=>{if(!t){let t=this;console.log("Received values of form: ",e),t.$http.post("/v1/users/register",e).then((function(s){0!==s.data.errcode?E(t.form,e,s.data.msg):n.Z.success("注册成功")}))}}))}}},At=Vt,Ht=(0,d.Z)(At,Nt,Ft,!1,null,"663fb3eb",null),Gt=Ht.exports,qt={name:"LoginView",components:{LoginPanel:Ut,RegisterPanel:Gt},computed:{},methods:{},data(){return{action:"login"}}},zt=qt,Dt=(0,d.Z)(zt,It,Mt,!1,null,"0475057c",null),Lt=Dt.exports,Kt=function(){var t=this;t._self._c;return t._m(0)},Bt=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"about"},[e("h1",[t._v("This is an about page1")])])}],Yt={},Jt=(0,d.Z)(Yt,Kt,Bt,!1,null,null,null),Wt=Jt.exports;o.ZP.use(h.ZP);const Qt=[{path:"/",name:"home",component:Z,children:[{path:"",component:dt}]},{path:"/about",name:"about",component:Wt},{path:"/login",name:"login",component:Lt},{path:"/chat",name:"chat",component:Z,children:[{path:"",component:dt}]},{path:"/room",name:"room",component:Z,children:[{path:"",component:St}]},{path:"/:catchAll(.*)",redirect:"/"}],Xt=new h.ZP({mode:"history",routes:Qt});var te=Xt,ee=s(63822);const se={info:{},auth:!1,token:null,expired_at:null},ae={LOGIN(t){t.auth=!0},LOGOUT(t){t.auth=!1,localStorage.removeItem("userInfo"),localStorage.removeItem("token"),localStorage.removeItem("expired_at")},SET_USER_INFO(t,e){t.info={id:e.id,name:e.name,nickname:e.nickname,avatar:e.avatar,gender:e.gender,birthday:e.birthday,created_at:e.created_at},localStorage.setItem("userInfo",JSON.stringify(e))},REFRESH_TOKEN(t,e){var s="Bearer "+e.token,a=1e3*e.expired_at;t.token=s,t.expired_at=a,localStorage.setItem("token",s),localStorage.setItem("expired_at",a),console.log(localStorage.getItem("token"))}},oe={LOGIN(t,e){t.commit("LOGIN"),this.dispatch("SET_USER_INFO",e)},LOGOUT(t){t.commit("LOGOUT")},SET_USER_INFO(t,e){t.commit("SET_USER_INFO",e)},REFRESH_TOKEN(t,e){t.commit("REFRESH_TOKEN",e)},GET_USER(){S(this)}};var re={state:se,mutations:ae,actions:oe};const ie={chats:[],currentChat:{},currentMsgs:[],haveMoreMsg:!0},ne={SET_CHATS(t,e){t.chats=e},SET_CURRENT_CHAT(t,e){t.currentChat=e},SET_CURRENT_MSGS(t,e){t.currentMsgs=e},APPEND_CURRENT_MSGS(t,e){t.currentMsgs.unshift(...e)},SET_HAVE_MORE_MSG(t,e){t.haveMoreMsg=e}},ce={GET_CHATS(t){let e=this;e._vm.$http.get("/v1/chats").then((function(e){0!==e.data.errcode?n.Z.error(e.data.msg):t.commit("SET_CHATS",e.data.data||[])})).catch((function(t){console.log(t)}))},SET_CHATS(t,e){t.commit("SET_CHATS",e)},async GET_CHAT_MESSAGE(t,e){if(e.id)try{const s=await this._vm.$http.get(`/v1/rooms/${e.id}/messages`);if(0!==s.data.errcode)n.Z.error(s.data.msg);else{let e=s.data.data||[];t.commit("SET_CURRENT_MSGS",e),e.length<20&&t.commit("SET_HAVE_MORE_MSG",!1)}console.log("获取到msg")}catch(s){throw console.log(s),s}},async GET_MORE_MESSAGE(t){try{let e=ie.currentChat;if(e&&ie.haveMoreMsg){let s=ie.currentMsgs.length>0?ie.currentMsgs[0].id:0;const a=await this._vm.$http.get(`/v1/rooms/${e.id}/messages?min_msg_id=${s}`);if(0!==a.data.errcode)n.Z.error(a.data.msg);else{let e=a.data.data||[];t.commit("APPEND_CURRENT_MSGS",e),e.length<20&&t.commit("SET_HAVE_MORE_MSG",!1)}console.log("获取到msg")}}catch(e){throw console.log(e),e}},async SET_CURRENT_CHAT(t,e){try{t.commit("SET_HAVE_MORE_MSG",!0),await this.dispatch("GET_CHAT_MESSAGE",e),t.commit("SET_CURRENT_CHAT",e),console.log("设置聊天")}catch(s){throw console.log(s),s}}};var le={state:ie,mutations:ne,actions:ce};const de={rooms:[],currentRoom:{}},ue={SET_ROOMS(t,e){t.rooms=e},SET_CURRENT_ROOM(t,e){t.currentRoom=e}},me={GET_ROOMS(t){let e=this;e._vm.$http.get("/v1/rooms").then((function(e){0!==e.data.errcode?n.Z.error(e.data.msg):t.commit("SET_ROOMS",e.data.data)})).catch((function(t){console.log(t)}))},SET_ROOMS(t,e){t.commit("SET_ROOMS",e)},SET_CURRENT_ROOM(t,e){t.commit("SET_CURRENT_ROOM",e)}};var he={state:de,mutations:ue,actions:me};const pe={currentMenu:""},ve={SET_CURRENT_MENU(t,e){t.currentMenu=e}},fe={SET_CURRENT_MENU(t,e){t.commit("SET_CURRENT_MENU",e)}};var ge={state:pe,mutations:ve,actions:fe};const _e={socket:null,timer:null},Ce={SET_SOCKET(t,e){t.socket=e},SET_TIMER(t,e){t.timer=e},CLEAR_TIMER(t){clearTimeout(t.timer)}},be={CONN_SOCKET(t,e){e=e||this;const s=new WebSocket(`ws://${window.location.host}/v1/ws?Authorization=${localStorage.getItem("token")}`);s.onopen=function(){console.log("WebSocket 连接已建立"),t.commit("CLEAR_TIMER")},s.onmessage=function(t){const s=JSON.parse(t.data);console.log("收到消息:",s),console.log("that",e);for(let o=0;o<e.state.chat.chats.length;o++)if(s.sender_id!=e.state.user.info.id&&s.receiver_id==e.state.chat.chats[o].id&&s.msg_type!=e._vm._const.TypeNotice){e.state.chat.chats[o].unread_count=(e.state.chat.chats[o].unread_count||0)+1;break}if(s.receiver_id==e.state.chat.currentChat.id)if(s.sender_id!=e.state.user.info.id){if(e.state.chat.currentMsgs.push(s),console.log("message.msg_type == that._vm._const.TypeNotice",s.msg_type==e._vm._const.TypeNotice),console.log("message.operate == that._vm._const.OperateJoinRoom",s.operate,e._vm._const.OperateJoinRoom),s.msg_type==e._vm._const.TypeNotice)if(s.operate==e._vm._const.OperateJoinRoom){var a=e.state.chat.currentChat.users.some((t=>t.id==s.sender_id));a||e.state.chat.currentChat.users.push(s.sender)}else s.operate==e._vm._const.OperateQuitRoom&&(e.state.chat.currentChat.users=e.state.chat.currentChat.users.filter((t=>t.id!=s.sender_id)))}else for(let o=0;o<e.state.chat.currentMsgs.length;o++)if(e.state.chat.currentMsgs[o].id==s.id){e.state.chat.currentMsgs[o].readers=s.readers,e.state.chat.currentMsgs[o].unreaders=s.unreaders;break}},s.onclose=function(s){console.log("WebSocket 连接已关闭"),console.log("event",s),be.RECONNECT_SOCKET(t,e)},s.onerror=function(t){console.error("WebSocket 连接出错:",t)},t.commit("SET_SOCKET",s)},CLOSE_SOCKET(t){this.$store.state.socket&&(this.$store.state.socket.close(),t.commit("SET_SOCKET",null))},RECONNECT_SOCKET(t,e){console.log("RECONNECT_SOCKET");const s=setTimeout((function(){console.log("Reconnecting WebSocket..."),be.CONN_SOCKET(t,e)}),2e3);t.commit("SET_TIMER",s)}};var ye={state:_e,mutations:Ce,actions:be};o.ZP.use(ee.ZP);var we=new ee.ZP.Store({state:{},getters:{},mutations:{},actions:{},modules:{user:re,chat:le,room:he,menu:ge,socket:ye}}),Te=s(44161);s(62467);const je="";var Re={API_URL:je};const ke=1,Ee=2,Se=3,Ie=4,Me=5,$e=6,Oe=7,xe=8,Pe=9,Ze="create_room",Ue="join_room",Ne="quit_room";var Fe={TypeNotice:ke,TypeText:Ee,TypeImg:Se,TypeFile:Ie,TypeVoice:Me,TypeVideo:$e,TypeLocation:Oe,TypeChatRecords:xe,TypeShare:Pe,OperateCreateRoom:Ze,OperateJoinRoom:Ue,OperateQuitRoom:Ne};o.ZP.http=o.ZP.prototype.$http=Te.Z,o.ZP.prototype.$moment=st(),o.ZP.prototype._config=Re,o.ZP.prototype._const=Fe,o.ZP.prototype.utils=a["default"],o.ZP.prototype._genderMap={0:"未知",1:"男",2:"女"},o.ZP.config.productionTip=!1,o.ZP.prototype.globalClick=function(t){document.addEventListener("click",t)},new o.ZP({router:te,store:we,render:t=>t(m),created(){this.$http.interceptors.request.use((t=>{let e=localStorage.getItem("token");return e&&(t.headers.Authorization=e),t}),(t=>Promise.reject(t))),this.$http.interceptors.response.use((t=>(1==t.data.errcode?"/login"!==this.$route.path&&this.$router.push("/login"):t.headers.authorization,t)),(t=>Promise.reject(t)))}}).$mount("#app")}},e={};function s(a){var o=e[a];if(void 0!==o)return o.exports;var r=e[a]={id:a,loaded:!1,exports:{}};return t[a].call(r.exports,r,r.exports,s),r.loaded=!0,r.exports}s.m=t,function(){var t=[];s.O=function(e,a,o,r){if(!a){var i=1/0;for(d=0;d<t.length;d++){a=t[d][0],o=t[d][1],r=t[d][2];for(var n=!0,c=0;c<a.length;c++)(!1&r||i>=r)&&Object.keys(s.O).every((function(t){return s.O[t](a[c])}))?a.splice(c--,1):(n=!1,r<i&&(i=r));if(n){t.splice(d--,1);var l=o();void 0!==l&&(e=l)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[a,o,r]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){s.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={143:0};s.O.j=function(e){return 0===t[e]};var e=function(e,a){var o,r,i=a[0],n=a[1],c=a[2],l=0;if(i.some((function(e){return 0!==t[e]}))){for(o in n)s.o(n,o)&&(s.m[o]=n[o]);if(c)var d=c(s)}for(e&&e(a);l<i.length;l++)r=i[l],s.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return s.O(d)},a=self["webpackChunkchatroom"]=self["webpackChunkchatroom"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(68187)}));a=s.O(a)})();
//# sourceMappingURL=app.5b9708c0.js.map